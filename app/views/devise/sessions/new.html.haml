- @errors = flash[:errors] || (alert && { 'email' => alert })

%main.govuk-main-wrapper#main-content{role: 'main'}
  %fieldset.govuk-fieldset
    %legend.govuk-fieldset__legend.govuk-fieldset__legend--xl
      %h1.govuk-heading-xl Retrofitted Vehicles Upload Portal
      %h2.govuk-heading-l Sign in

      - if @errors
        .govuk-error-summary{'aria-labelledby': 'error-summary-title',
                     'data-module': 'govuk-error-summary',
                     role: 'alert',
                     tabindex: '-1'}
          %h2#error-summary-title.govuk-error-summary__title
            There was a problem
          .govuk-error-summary__body
            %ul.govuk-list.govuk-error-summary__list
              - transformed_flat_errors(@errors).each_with_index do |error, index|
                %li
                  = link_to(error.first, "##{error.second}_error", id: "#{error.second}-#{index}")

      %p
        If you want to set up an account or need support email us at
        = mail_to Rails.configuration.x.contact_email

      = form_for(resource, as: resource_name, url: session_path(resource_name), html: {novalidate: 'novalidate'}) do |f|
        .govuk-form-group{class: ('govuk-form-group--error' if @errors)}
          = f.label :username, 'Email', class: 'govuk-label'
          %span#email_error.govuk-error-message
            - if @errors
              %span.govuk-visually-hidden Error:
              = @errors['email']
          = f.email_field :username,
                          autofocus: true,
                          autocomplete: 'username',
                          maxlength: 45,
                          spellcheck: false,
                          class: "govuk-input govuk-!-width-two-thirds #{'govuk-input--error' if @errors}"

        .govuk-form-group{class: ('govuk-form-group--error' if @errors)}
          = f.label :password, class: 'govuk-label'
          %span#password_error.govuk-error-message
            - if @errors
              %span.govuk-visually-hidden Error:
              = @errors['password'] || @errors['email']
          = f.password_field :password,
                              autocomplete: 'current-password',
                              class: "govuk-input govuk-!-width-two-thirds #{'govuk-input--error' if @errors}"

        .govuk-form-group
          = f.submit 'Continue', class: 'govuk-button', 'data-module': 'govuk-button'
          %p
            = link_to 'Forgot your password?', reset_passwords_path, class: 'govuk-link', id: 'forgot-password'
